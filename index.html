<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3D Image Generator + Cube Preview</title>
  <style>
    :root{--bg:#0b0f14;--card:#121826;--text:#e6eef7;--muted:#a9b3c5;--accent:#6cc5ff;--ok:#34d399;--max:1100px}
    *{box-sizing:border-box}
    body{margin:0;font:16px system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--text);background:linear-gradient(180deg,#0b0f14,#0a0d12)}
    header{position:sticky;top:0;background:rgba(18,24,38,.9);backdrop-filter:blur(8px);border-bottom:1px solid #1c2436}
    .wrap{max-width:var(--max);margin:0 auto;padding:16px;display:flex;align-items:center;justify-content:space-between;gap:12px}
    h1{font-size:clamp(18px,4vw,26px);margin:0}
    main{max-width:var(--max);margin:20px auto;padding:0 16px;display:grid;gap:16px}
    .panel{background:var(--card);border:1px solid #1c2436;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .inner{padding:18px}
    label{display:block;margin-bottom:6px;color:var(--muted)}
    input[type=text],textarea{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #222e46;background:#0e1422;color:var(--text)}
    textarea{resize:vertical;min-height:96px}
    .row{display:grid;gap:10px}
    button{border:none;background:linear-gradient(135deg,#7bd0ff,#5cb3ff);color:#07131f;padding:12px 16px;border-radius:12px;font-weight:700;cursor:pointer;box-shadow:0 6px 16px rgba(88,173,255,.35)}
    button:disabled{opacity:.6;cursor:not-allowed}
    .muted{color:var(--muted)}
    .drop{border:2px dashed #2a3959;border-radius:16px;padding:18px;text-align:center;background:#0d1422;color:var(--muted)}
    .drop.drag{border-color:var(--accent);background:#0e1828;color:var(--text)}

    .scene{width:100%;aspect-ratio:1/1;display:grid;place-items:center;perspective:1000px;background:#0e1422;border-radius:14px;border:1px solid #1c2436;overflow:hidden}
    .cube{position:relative;width:min(70vmin,520px);height:min(70vmin,520px);transform-style:preserve-3d;cursor:grab}
    .cube.animate{animation:spin 16s linear infinite}
    .face{position:absolute;inset:0;width:100%;height:100%;background:#101727 center/cover no-repeat;border:1px solid #1c2436}
    @keyframes spin{from{transform:rotateX(-18deg) rotateY(0deg)} to{transform:rotateX(-18deg) rotateY(360deg)}}

    figure{margin:0;border:1px solid #1c2436;border-radius:12px;overflow:hidden;background:#0e1420}
    img{width:100%}
    figcaption{padding:8px 10px;color:var(--muted);border-top:1px solid #1c2436;display:flex;justify-content:space-between}
    a.dl{font-size:12px;color:#9fd0ff;text-decoration:none}
  </style>
</head>
<body>

<header>
  <div class="wrap">
    <h1>3D Image Generator + Cube Preview</h1>
  </div>
</header>

<main>

<section class="panel">
  <div class="inner row">
    <form id="gen-form" class="row">
      <div class="drop" id="drop">
        <input id="file" type="file" accept="image/*" style="display:none" required />
        <p><b>Drag & drop</b> or <a href="#" id="pick">choose</a></p>
        <p class="muted" id="fileInfo">No file selected</p>
      </div>

      <label>Description</label>
      <textarea id="desc" required></textarea>

      <label>n8n Webhook URL</label>
      <input id="endpoint" type="text" placeholder="https://YOUR-N8N/webhook" required />

      <label>API Key (optional)</label>
      <input id="key" type="text" placeholder="x-api-key value" />

      <button id="submit">Generate</button>
      <span id="status" class="muted">Idle</span>
    </form>
  </div>
</section>

<section class="panel">
  <div class="inner">
    <div class="scene" id="scene">
      <div class="cube animate" id="cube">
        <div class="face" id="front"></div>
        <div class="face" id="back"></div>
        <div class="face" id="left"></div>
        <div class="face" id="right"></div>
        <div class="face" id="top"></div>
        <div class="face" id="bottom"></div>
      </div>
    </div>
  </div>
</section>

<section class="panel">
  <div class="inner">
    <h3>Generated Views</h3>
    <div id="results"></div>
  </div>
</section>

</main>

<script>
const $ = (q)=>document.querySelector(q);
const cube = $('#cube');

function setFace(id, src){
  if(!src) return;
  if(!src.startsWith('http') && !src.startsWith('data:')) src = 'data:image/png;base64,'+src;
  $(id).style.backgroundImage = `url('${src}')`;
}

$('#gen-form').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const endpoint = $('#endpoint').value.trim();
  const key = $('#key').value.trim();
  const file = $('#file').files[0];
  const desc = $('#desc').value.trim();

  const fd = new FormData();
  fd.append('image', file);
  fd.append('description', desc);

  const res = await fetch(endpoint, {method:'POST', headers:key?{'x-api-key':key}:{}, body:fd});
  const data = await res.json();

  const map = {
    front: data.front_url || data.front,
    back: data.back_url || data.back,
    left: data.left_url || data.left,
    right: data.right_url || data.right,
    top: data.top_url || data.top,
    bottom: data.bottom_url || data.bottom,
  };

  setFace('#front', map.front);
  setFace('#back', map.back);
  setFace('#left', map.left);
  setFace('#right', map.right);
  setFace('#top', map.top);
  setFace('#bottom', map.bottom);
});
</script>

</body>
</html>
